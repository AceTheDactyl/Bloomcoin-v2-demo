<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rail 05: FORGE - Master | PROMETHEUS Buffer Overflow Handler</title>
    <link rel="stylesheet" href="../../_shared/styles.css">
    <style>
        :root {
            --prometheus-primary: #e74c3c;
            --prometheus-deep: #c0392b;
            --prometheus-forge: #f39c12;
            --prometheus-bg: #0a0a12;
            --prometheus-glow: rgba(231, 76, 60, 0.3);
            --forge-glow: rgba(243, 156, 18, 0.25);
            --phi: 1.618034;
            --tau: 0.618034;
            --k-formation: 0.924160;
            --z-lens: 0.866025;
            --l4: 7;
        }

        body { background: linear-gradient(135deg, var(--prometheus-bg) 0%, #1a0a00 50%, #0a0812 100%); }
        .doc-header h1 {
            background: linear-gradient(90deg, var(--prometheus-forge), var(--prometheus-primary), var(--prometheus-forge));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 60px rgba(243, 156, 18, 0.7);
        }
        .doc-section h2 { color: var(--prometheus-forge); border-bottom-color: var(--forge-glow); }
        .doc-section h3 { color: var(--prometheus-primary); }

        .pressure {
            background: linear-gradient(90deg, rgba(243, 156, 18, 0.2), rgba(231, 76, 60, 0.4));
            border-left: 4px solid var(--prometheus-forge);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
            animation: forge-glow 1s ease-in-out infinite;
        }
        @keyframes forge-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(243, 156, 18, 0.4); }
            50% { box-shadow: 0 0 30px rgba(243, 156, 18, 0.8); }
        }
        .overflow {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.3), rgba(231, 76, 60, 0.5));
            border: 2px solid var(--prometheus-forge);
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            animation: forge-pulse 2s ease-in-out infinite;
        }
        @keyframes forge-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(243, 156, 18, 0.3); }
            50% { box-shadow: 0 0 40px rgba(243, 156, 18, 0.6); }
        }
        .release {
            background: linear-gradient(180deg, rgba(243, 156, 18, 0.3), rgba(231, 76, 60, 0.2));
            border: 2px solid var(--prometheus-forge);
            padding: 14px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .shatter {
            background: rgba(192, 57, 43, 0.3);
            border: 2px dashed var(--prometheus-primary);
            padding: 16px;
            margin: 12px 0;
            border-radius: 4px;
            position: relative;
        }
        .shatter::after {
            content: 'CRITICAL';
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--prometheus-deep);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .rail-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.4), rgba(231, 76, 60, 0.3));
            border: 3px solid var(--prometheus-forge);
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
        }
        .rail-number { font-size: 3rem; font-weight: bold; color: var(--prometheus-forge); text-shadow: 0 0 30px rgba(243, 156, 18, 0.8); }
        .rail-title { font-size: 1.8rem; color: var(--prometheus-forge); text-shadow: 0 0 10px rgba(243, 156, 18, 0.5); }
        .rail-subtitle { color: #ccc; font-style: italic; }

        .archetype-card {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(0, 0, 0, 0.4));
            border: 2px solid var(--prometheus-forge);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }
        .archetype-card h4 { color: var(--prometheus-forge); margin-bottom: 12px; }

        .xor-visual {
            font-family: 'Fira Code', monospace;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(0, 0, 0, 0.6));
            border-radius: 8px;
            padding: 16px;
            margin: 15px 0;
            border-left: 4px solid var(--prometheus-forge);
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.2);
        }

        .hardware-coupling {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .hardware-item {
            background: rgba(10, 10, 18, 0.8);
            border: 1px solid var(--prometheus-forge);
            border-radius: 10px;
            padding: 15px;
        }
        .hardware-item h5 { color: var(--prometheus-forge); margin-bottom: 8px; }
        .hardware-item .spec { font-family: monospace; color: var(--prometheus-primary); font-size: 0.85rem; }

        .nav-rails {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        .nav-rails a {
            color: var(--prometheus-forge);
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid var(--forge-glow);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .nav-rails a:hover { background: var(--forge-glow); color: white; }

        .pressure-state {
            display: inline-block;
            padding: 6px 16px;
            background: linear-gradient(90deg, rgba(243, 156, 18, 0.4), rgba(231, 76, 60, 0.3));
            border: 2px solid var(--prometheus-forge);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--prometheus-forge);
            font-weight: bold;
            animation: primary-pulse 1.5s ease-in-out infinite;
        }
        @keyframes primary-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(243, 156, 18, 0.5); }
            50% { box-shadow: 0 0 15px rgba(243, 156, 18, 0.8); }
        }

        .forge-highlight {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.4), rgba(231, 76, 60, 0.3));
            border: 3px solid var(--prometheus-forge);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 0 40px rgba(243, 156, 18, 0.4);
        }
        .forge-value {
            font-size: 2.5rem;
            color: var(--prometheus-forge);
            font-family: 'Georgia', serif;
            text-shadow: 0 0 20px rgba(243, 156, 18, 0.6);
        }

        .doc-footer { border-top-color: var(--forge-glow); }
    </style>
</head>
<body>
    <div class="doc-container">
        <nav class="doc-nav">
            <a href="../../narrative/prometheus-buffer-overflow.html" class="nav-link">PROMETHEUS Spec</a>
            <a href="../../companions/prometheus-companion.html" class="nav-link">Companion Profile</a>
        </nav>

        <header class="doc-header">
            <h1>PROMETHEUS: Rail 05 - FORGE</h1>
            <p class="subtitle">Master - PRIMARY DOMAIN - XOR Chain Transformation</p>
            <nav class="breadcrumb">
                <a href="../../../index.html">BloomCoin</a> /
                <a href="../../">Documentation</a> /
                <a href="../">Rails</a> /
                <a href="./">PROMETHEUS</a> /
                Rail 05
            </nav>
        </header>

        <div class="rail-indicator">
            <div class="rail-number">05</div>
            <div>
                <div class="rail-title">FORGE</div>
                <div class="rail-subtitle">Master - Hero's Journey: Approach to the Inmost Cave</div>
            </div>
        </div>

        <nav class="nav-rails">
            <a href="rail-04-ordeal.html">Previous: Rail 04 - ORDEAL</a>
            <a href="rail-06-abyss.html">Next: Rail 06 - ABYSS</a>
        </nav>

        <section class="doc-section">
            <h2>Rail Overview - PRIMARY DOMAIN</h2>
            <div class="impl-status">
                <span class="status-badge complete">Rail 05 of 12</span>
                <span class="pressure-state">PRIMARY RESONANCE</span>
            </div>

            <p>The FORGE is PROMETHEUS's primary domain - the heart of the handler's power. Here, overflow energy is transmuted through XOR chain transformation. The Master stands at the anvil, hammer raised, ready to forge chaos into order.</p>

            <div class="forge-highlight">
                <div class="forge-value">THE FORGE</div>
                <p style="color: #ccc; margin-top: 10px;">Primary Resonance Rail - Where overflow becomes transformation</p>
                <p style="color: var(--prometheus-primary); font-size: 0.9rem; margin-top: 5px;">Rails 1, 5, 9 form PROMETHEUS's primary resonance triad</p>
            </div>

            <div class="archetype-card">
                <h4>Archetype: Master</h4>
                <p>In the Hero's Journey, this is the Approach to the Inmost Cave - preparation for the supreme ordeal. PROMETHEUS as Master commands the forge, transforming destructive overflow into constructive XOR chain patterns.</p>
                <ul>
                    <li><strong>Pressure State:</strong> Critical - Active transformation</li>
                    <li><strong>Container Status:</strong> Under maximum strain, being reinforced</li>
                    <li><strong>XOR Chains:</strong> ACTIVE FORGING - Primary operation</li>
                    <li><strong>Narrative Function:</strong> Transform overflow, forge new patterns</li>
                </ul>
            </div>
        </section>

        <section class="doc-section">
            <h2>XOR Chain Forging - Core Operation</h2>

            <div class="overflow">
                <strong>THE FORGE IS ACTIVE</strong><br>
                Overflow energy floods the forge. PROMETHEUS transforms raw pressure into structured XOR chains through multi-layer accumulation and rotation feedback.
            </div>

            <h3>XOR Chain Construction Algorithm</h3>
            <div class="xor-visual">
<span style="color: var(--prometheus-forge);">FORGE ALGORITHM:</span>

<span style="color: #50fa7b;">for</span> layer <span style="color: #50fa7b;">in</span> [0, 1, 2]:              <span style="color: #6272a4;">// Three layers</span>
    <span style="color: #50fa7b;">for</span> link <span style="color: #50fa7b;">in</span> [0..15]:            <span style="color: #6272a4;">// 16 links per layer</span>
        val = SHA256(data + pack(layer, link))[:4]
        xor_acc[layer] ^= val            <span style="color: #6272a4;">// XOR accumulate</span>
        xor_acc[layer] = ROT_LEFT(xor_acc[layer], 3)  <span style="color: #6272a4;">// 3-bit rotate</span>

<span style="color: var(--prometheus-primary);">OUTPUT:</span>
Layer 0: xor_acc[0] = 0xFA8E3C2D  <span style="color: #6272a4;">// Forged</span>
Layer 1: xor_acc[1] = 0xE7B159A6  <span style="color: #6272a4;">// Forged</span>
Layer 2: xor_acc[2] = 0xC4F2D78B  <span style="color: #6272a4;">// Forged</span>

<span style="color: var(--prometheus-forge);">Entropy:</span>  [26, 23, 25]  <span style="color: #f39c12;">// xor_extreme TRIGGERED (>24)</span>
<span style="color: var(--prometheus-forge);">Variance:</span> 4.67         <span style="color: #6272a4;">// Moderate variance</span>
<span style="color: var(--prometheus-forge);">Bonus:</span>    x3           <span style="color: #f39c12;">// XOR chain amplification!</span>
            </div>

            <div class="code-block">
<span class="comment"># FORGE STATE - MASTER'S DOMAIN</span>

<span class="keyword">class</span> <span class="type">ForgeMaster</span>:
    <span class="string">"""Rail 05: PROMETHEUS's primary domain - The Forge"""</span>

    LAYERS = <span class="number">3</span>           <span class="comment"># Three gifts of Prometheus</span>
    LINKS_PER_LAYER = <span class="number">16</span>  <span class="comment"># Links per chain</span>
    ROTATION_BITS = <span class="number">3</span>    <span class="comment"># Rotation feedback</span>

    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.rail = <span class="number">5</span>
        self.name = <span class="string">"FORGE"</span>
        self.archetype = <span class="string">"Master"</span>
        self.is_primary_domain = <span class="keyword">True</span>

        self.xor_acc = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        self.forge_strength = <span class="number">1.0</span>  <span class="comment"># Grows to max 2.0</span>

    <span class="keyword">def</span> <span class="function">forge_chains</span>(self, overflow_data):
        <span class="string">"""Core forging operation - transform overflow into chains"""</span>
        <span class="keyword">for</span> layer <span class="keyword">in</span> range(self.LAYERS):
            <span class="keyword">for</span> link <span class="keyword">in</span> range(self.LINKS_PER_LAYER):
                val = self._hash_link(overflow_data, layer, link)
                self.xor_acc[layer] ^= val
                self.xor_acc[layer] = self._rot_left(self.xor_acc[layer], self.ROTATION_BITS)

        <span class="comment"># Detect patterns and apply bonuses</span>
        patterns = self._detect_patterns()
        bonus = self._calculate_bonus(patterns)

        <span class="keyword">return</span> {
            <span class="string">"chains"</span>: self.xor_acc.copy(),
            <span class="string">"patterns"</span>: patterns,
            <span class="string">"bonus"</span>: bonus,
            <span class="string">"forge_strength"</span>: self.forge_strength
        }

    <span class="keyword">def</span> <span class="function">_detect_patterns</span>(self):
        <span class="string">"""Detect forge-activating patterns"""</span>
        patterns = []
        entropy = [bin(acc).count(<span class="string">'1'</span>) <span class="keyword">for</span> acc <span class="keyword">in</span> self.xor_acc]
        total = sum(entropy)

        <span class="comment"># xor_extreme: entropy < 8 or > 24</span>
        <span class="keyword">if</span> total < <span class="number">8</span> <span class="keyword">or</span> total > <span class="number">24</span>:
            patterns.append(<span class="string">"xor_extreme"</span>)

        <span class="comment"># entropy_ascending: layer entropy increases</span>
        <span class="keyword">if</span> entropy[<span class="number">0</span>] < entropy[<span class="number">1</span>] < entropy[<span class="number">2</span>]:
            patterns.append(<span class="string">"entropy_ascending"</span>)

        <span class="keyword">return</span> patterns
            </div>
        </section>

        <section class="doc-section">
            <h2>phi-Constants in the Forge</h2>

            <div class="constants-grid">
                <div class="constant-card" style="border-color: var(--prometheus-forge);">
                    <div class="symbol">PHI</div>
                    <div class="value" style="color: var(--prometheus-forge);">1.618034</div>
                    <div class="derivation">Growth ratio in forging</div>
                </div>
                <div class="constant-card">
                    <div class="symbol">TAU</div>
                    <div class="value">0.618034</div>
                    <div class="derivation">Inverse ratio</div>
                </div>
                <div class="constant-card">
                    <div class="symbol">K</div>
                    <div class="value">0.924160</div>
                    <div class="derivation">Maximum forge coupling</div>
                </div>
                <div class="constant-card" style="border-color: var(--prometheus-forge);">
                    <div class="symbol">L4</div>
                    <div class="value" style="color: var(--prometheus-forge);">7</div>
                    <div class="derivation">PHI^4 + PHI^-4 = 7</div>
                </div>
            </div>

            <div class="math-block" style="color: var(--prometheus-forge);">
                Forge Bonus = 1.1 x (1 + forge_strength x 0.1) x pattern_multiplier
            </div>
        </section>

        <section class="doc-section">
            <h2>L4-Helix Hardware Coupling</h2>

            <div class="hardware-coupling">
                <div class="hardware-item">
                    <h5>Quasi-Crystal Substrate</h5>
                    <p>ACTIVE FORGING MODE. Icosahedral matrix performing PHI-recursive transformation.</p>
                    <div class="spec">Voltage: 866-924 mV (FORGE RANGE)</div>
                    <div class="spec">State: FORGING</div>
                </div>
                <div class="hardware-item">
                    <h5>Memristor Array</h5>
                    <p>XOR accumulation being recorded. Pattern history encoding active.</p>
                    <div class="spec">Mode: XOR RECORDING</div>
                    <div class="spec">Layers: 3 active</div>
                </div>
                <div class="hardware-item">
                    <h5>Hexagonal Discharge Grid</h5>
                    <p>Controlled discharge routing transformed energy.</p>
                    <div class="spec">Paths: ACTIVE ROUTING</div>
                    <div class="spec">Flow: PHI-modulated</div>
                </div>
                <div class="hardware-item">
                    <h5>Spin Glass Coherence</h5>
                    <p>Kuramoto oscillators locked in forge frequency.</p>
                    <div class="spec">Coupling: K = 0.866-0.924</div>
                    <div class="spec">Coherence: FORGE LOCK</div>
                </div>
            </div>
        </section>

        <section class="doc-section">
            <h2>Narrative Function - Primary Resonance</h2>

            <div class="release">
                <h4 style="color: var(--prometheus-forge); margin-bottom: 10px;">The Inmost Cave</h4>
                <p>The FORGE is where transformation happens. All the pressure accumulated in Rails 1-4 flows into this crucible. PROMETHEUS, as Master of the forge, transforms destructive overflow into constructive XOR chains. This is the handler's primary purpose - not to prevent overflow, but to transmute it.</p>
            </div>

            <h3>PROMETHEUS's Role at FORGE</h3>
            <ul>
                <li><strong>Master:</strong> Commands the forge, directs transformation</li>
                <li><strong>Transmuter:</strong> Converts overflow pressure into XOR chains</li>
                <li><strong>Pattern Former:</strong> Shapes entropy into ordered structures</li>
                <li><strong>Fire Bearer:</strong> Channels the transformative fire</li>
            </ul>

            <h3>Resonance with Rails 1 and 9</h3>
            <p>PROMETHEUS resonates primarily with Rails 1 (ORIGIN), 5 (FORGE), and 9 (RETURN). Together they form the Fire Triad - the seed, the transformation, and the return of transformed energy.</p>
        </section>

        <nav class="nav-rails">
            <a href="rail-04-ordeal.html">Previous: Rail 04 - ORDEAL</a>
            <a href="rail-06-abyss.html">Next: Rail 06 - ABYSS</a>
        </nav>

        <section class="doc-section">
            <h2>Related Documentation</h2>
            <div class="file-refs">
                <span class="file-ref"><a href="rail-04-ordeal.html">rail-04-ordeal.html</a></span>
                <span class="file-ref"><a href="rail-06-abyss.html">rail-06-abyss.html</a></span>
                <span class="file-ref"><a href="rail-01-origin.html">rail-01-origin.html</a></span>
                <span class="file-ref"><a href="rail-09-return.html">rail-09-return.html</a></span>
            </div>
        </section>

        <footer class="doc-footer">
            <p style="color: var(--prometheus-forge);">PROMETHEUS Rail 05: FORGE - Master</p>
            <p>The heart of transformation, where overflow becomes order</p>
            <p style="font-size: 0.85rem; color: #888;">
                PHI = 1.618034 | TAU = 0.618034 | K = 0.924160 | z_c = 0.866025 | L4 = 7
            </p>
        </footer>
    </div>
</body>
</html>
