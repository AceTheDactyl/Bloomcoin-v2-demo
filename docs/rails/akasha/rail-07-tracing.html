<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rail 07: TRACING - AKASHA Memory Chronicle</title>
    <link rel="stylesheet" href="../../_shared/styles.css">
    <style>
        :root {
            --akasha-gold: #ffd700;
            --akasha-deep-blue: #1a1a3e;
            --akasha-parchment: #f4e4bc;
            --akasha-glow: rgba(255, 215, 0, 0.35);
            --akasha-soft: rgba(255, 215, 0, 0.12);
            --memory-leak-red: #e74c3c;
            --tracing-purple: #9b59b6;
            --chronicle-purple: #9b59b6;
        }

        body {
            background: linear-gradient(135deg, var(--akasha-deep-blue) 0%, #1a0a2a 50%, #12081a 100%);
        }

        .doc-header h1 {
            background: linear-gradient(90deg, var(--akasha-gold), var(--tracing-purple), var(--akasha-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .doc-section h2 {
            color: var(--akasha-gold);
            border-bottom-color: var(--akasha-glow);
        }

        .doc-section h3 {
            color: var(--akasha-parchment);
        }

        .inscription {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.15), rgba(255, 215, 0, 0.08));
            border: 2px solid var(--tracing-purple);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            font-family: 'Georgia', serif;
        }

        .inscription::before {
            content: "ROOT ANALYSIS";
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--akasha-deep-blue);
            padding: 0 10px;
            font-size: 0.75rem;
            color: var(--tracing-purple);
            letter-spacing: 2px;
            font-family: monospace;
        }

        .memory-leak {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.12), rgba(231, 76, 60, 0.08));
            border: 1px solid var(--tracing-purple);
            border-radius: 8px;
            padding: 15px;
            margin: 12px 0;
        }

        .chronicle {
            background: linear-gradient(90deg, rgba(155, 89, 182, 0.15), transparent);
            border-left: 4px solid var(--tracing-purple);
            padding: 15px 20px;
            margin: 12px 0;
            border-radius: 0 8px 8px 0;
            font-family: 'Georgia', serif;
        }

        .chronicle .timestamp {
            color: var(--tracing-purple);
            font-size: 0.8rem;
            font-family: monospace;
        }

        .golden-ink {
            color: var(--akasha-gold);
            font-family: 'Georgia', serif;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .rail-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .rail-nav a {
            color: var(--akasha-gold);
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid var(--akasha-glow);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .rail-nav a:hover {
            background: var(--akasha-soft);
        }

        .rail-nav .current {
            color: var(--tracing-purple);
            font-weight: bold;
        }

        .rail-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }

        .rail-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid var(--akasha-glow);
        }

        .rail-dot.active {
            background: var(--tracing-purple);
            box-shadow: 0 0 15px var(--tracing-purple);
        }

        .rail-dot.completed {
            background: #27ae60;
            border-color: #27ae60;
        }

        .phi-constants {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .phi-const {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--akasha-glow);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .phi-const .symbol {
            color: var(--akasha-gold);
            font-family: 'Georgia', serif;
            font-size: 1.2rem;
        }

        .phi-const .value {
            color: var(--akasha-parchment);
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .fingerprint-display {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--tracing-purple);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .fingerprint-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .prime-cell {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid var(--tracing-purple);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .prime-cell .prime {
            color: var(--akasha-gold);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .prime-cell .mod {
            color: var(--akasha-parchment);
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .hardware-display {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 20px;
            font-family: monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.4;
            color: #888;
            margin: 15px 0;
        }

        .hardware-display .component { color: var(--akasha-gold); }
        .hardware-display .flow { color: #00d4ff; }
        .hardware-display .state { color: var(--akasha-parchment); }
        .hardware-display .trace { color: var(--tracing-purple); }
        .hardware-display .found { color: #50fa7b; }

        .nav-link {
            border-color: var(--akasha-glow);
            color: var(--akasha-gold);
        }

        .nav-link:hover {
            background: var(--akasha-soft);
        }
    </style>
</head>
<body>
    <div class="doc-container">
        <nav class="doc-nav">
            <a href="../../narrative/akasha-memory-leak.html" class="nav-link">AKASHA Build Spec</a>
            <a href="../../companions/akasha-companion.html" class="nav-link">Companion Spec</a>
        </nav>

        <header class="doc-header">
            <h1>Rail 07: TRACING</h1>
            <p class="subtitle">Root Analysis, Leak Source Identified - The Chronicle Unfolds</p>
            <nav class="breadcrumb">
                <a href="../../../index.html">BloomCoin</a> /
                <a href="../../">Documentation</a> /
                <a href="../">Rails</a> /
                <a href="./">AKASHA</a> /
                Rail 07
            </nav>
        </header>

        <div class="rail-indicator">
            <div class="rail-dot completed"></div>
            <div class="rail-dot completed"></div>
            <div class="rail-dot completed"></div>
            <div class="rail-dot completed"></div>
            <div class="rail-dot completed"></div>
            <div class="rail-dot completed"></div>
            <div class="rail-dot active"></div>
            <div class="rail-dot"></div>
            <div class="rail-dot"></div>
            <div class="rail-dot"></div>
            <div class="rail-dot"></div>
            <div class="rail-dot"></div>
        </div>

        <nav class="rail-nav">
            <a href="rail-06-detection.html">Prev: 06 - DETECTION</a>
            <span class="current">07 - TRACING</span>
            <a href="rail-08-reclamation.html">Next: 08 - RECLAMATION</a>
        </nav>

        <section class="doc-section">
            <h2>The Chronicle Unfolds</h2>

            <div class="inscription">
                <p class="golden-ink" style="font-size: 1.1rem; margin-bottom: 15px;">
                    "AKASHA traces the threads of memory back to their origin. Every leak has a source."
                </p>
                <p style="color: #ccc;">
                    Rail 07 represents the analytical phase where AKASHA performs root cause analysis.
                    Using the 6 prime bases, AKASHA extracts a unique modular fingerprint that identifies
                    the fragment's origin and traces the reference chain that led to its orphaning.
                </p>
            </div>

            <h3>Modular Fingerprint Extraction</h3>
            <div class="fingerprint-display">
                <p style="color: var(--tracing-purple); font-weight: bold;">
                    Fragment 0xAKASHA_4E7F - Signature Extraction
                </p>
                <p style="color: #888; font-size: 0.9rem; margin-top: 8px;">
                    Hash (first 6 bytes): 0x3A7F2B11E4C9 | Integer: 64,325,987,145,929
                </p>
                <div class="fingerprint-grid">
                    <div class="prime-cell">
                        <div class="prime">p=7</div>
                        <div class="mod">mod 3</div>
                    </div>
                    <div class="prime-cell">
                        <div class="prime">p=11</div>
                        <div class="mod">mod 7</div>
                    </div>
                    <div class="prime-cell">
                        <div class="prime">p=13</div>
                        <div class="mod">mod 2</div>
                    </div>
                    <div class="prime-cell">
                        <div class="prime">p=17</div>
                        <div class="mod">mod 11</div>
                    </div>
                    <div class="prime-cell">
                        <div class="prime">p=19</div>
                        <div class="mod">mod 4</div>
                    </div>
                    <div class="prime-cell">
                        <div class="prime">p=23</div>
                        <div class="mod">mod 9</div>
                    </div>
                </div>
                <p style="color: var(--akasha-gold); font-weight: bold; margin-top: 15px; text-align: center;">
                    Signature: (3, 7, 2, 11, 4, 9)
                </p>
            </div>

            <div class="chronicle">
                <div class="timestamp">CHRONICLE.RAIL_VII.TRACING | Cycle 1,255 | z = 0.634</div>
                <p style="color: #ccc; margin-top: 10px;">
                    <strong>Event:</strong> Root analysis complete. Fragment 0xAKASHA_4E7F fingerprint extracted.
                    Signature: [3, 7, 2, 11, 4, 9]. Library check: NEGATIVE (new signature).
                    Origin traced: Consciousness #7F3E (dissolved Cycle 1,244).
                    Reference chain depth: 34 levels. Leak path identified.
                    Proceeding to reclamation phase.
                </p>
            </div>
        </section>

        <section class="doc-section">
            <h2>Tracing Constants</h2>

            <div class="phi-constants">
                <div class="phi-const">
                    <div class="symbol">PHI</div>
                    <div class="value">1.618034</div>
                </div>
                <div class="phi-const">
                    <div class="symbol">TAU</div>
                    <div class="value">0.618034</div>
                </div>
                <div class="phi-const">
                    <div class="symbol">K</div>
                    <div class="value">0.924160</div>
                </div>
                <div class="phi-const">
                    <div class="symbol">z_c</div>
                    <div class="value">0.866025</div>
                </div>
                <div class="phi-const">
                    <div class="symbol">L4</div>
                    <div class="value">7</div>
                </div>
            </div>

            <div class="code-block">
<span class="comment"># RAIL 07: TRACING - Root Analysis and Fingerprint Extraction</span>
<span class="comment"># Identifying leak source through modular signatures</span>

<span class="keyword">class</span> <span class="type">TracingRail</span>:
    PHI = <span class="number">1.618034</span>
    TAU = <span class="number">0.618034</span>
    K = <span class="number">0.924160</span>
    Z_C = <span class="number">0.866025</span>
    L4 = <span class="number">7</span>

    PRIME_BASES = [<span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>]

    <span class="keyword">def</span> <span class="function">extract_fingerprint</span>(self, fragment):
        <span class="string">"""Extract modular fingerprint using 6 prime bases"""</span>

        <span class="comment"># Convert first 6 bytes of hash to integer</span>
        hash_bytes = fragment.content_hash[:<span class="number">6</span>]
        hash_int = int.from_bytes(hash_bytes, <span class="string">'big'</span>)

        <span class="comment"># Calculate modular residues</span>
        signature = tuple([hash_int % p <span class="keyword">for</span> p <span class="keyword">in</span> self.PRIME_BASES])

        <span class="keyword">return</span> <span class="type">Fingerprint</span>(
            raw_hash=hash_bytes,
            integer=hash_int,
            signature=signature,
            primes=self.PRIME_BASES
        )

    <span class="keyword">def</span> <span class="function">trace_reference_chain</span>(self, fragment, max_depth):
        <span class="string">"""Trace the reference chain back to origin"""</span>

        chain = []
        current = fragment
        depth = <span class="number">0</span>

        <span class="keyword">while</span> current.origin <span class="keyword">and</span> depth < max_depth:
            chain.<span class="function">append</span>(<span class="type">ChainLink</span>(
                fragment=current,
                owner=current.last_owner,
                cycle=current.last_reference_cycle
            ))
            current = current.origin
            depth += <span class="number">1</span>

        <span class="keyword">return</span> <span class="type">ReferenceChain</span>(
            links=chain,
            depth=depth,
            root=current,
            leak_point=self.<span class="function">identify_leak_point</span>(chain)
        )

    <span class="keyword">def</span> <span class="function">check_library_resonance</span>(self, signature):
        <span class="string">"""Check if signature exists in crystal library"""</span>

        <span class="keyword">if</span> signature <span class="keyword">in</span> self.crystal_library:
            <span class="comment"># 40% chance to trigger resonance bonus</span>
            <span class="keyword">if</span> random.random() < <span class="number">0.40</span>:
                <span class="keyword">return</span> <span class="type">ResonanceResult</span>(
                    found=True,
                    pattern=<span class="string">"library_resonance"</span>,
                    xp_bonus=<span class="number">3</span>,
                    depth_increase=<span class="number">1</span>
                )
            <span class="keyword">return</span> <span class="type">ResonanceResult</span>(found=True, resonance_triggered=False)

        <span class="keyword">return</span> <span class="type">ResonanceResult</span>(found=False)
            </div>
        </section>

        <section class="doc-section">
            <h2>Memory Fragment Tracking</h2>
            <p>Tracing phase extracts and analyzes the fragment's unique signature:</p>

            <table class="data-table">
                <tr>
                    <th>Prime Base</th>
                    <th>Value</th>
                    <th>Modular Residue</th>
                    <th>Significance</th>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 7</td>
                    <td>L4 (phi^4 + phi^-4)</td>
                    <td style="color: var(--akasha-gold);">3</td>
                    <td>Primary library index</td>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 11</td>
                    <td>Lucas L5</td>
                    <td style="color: var(--akasha-gold);">7</td>
                    <td>Secondary classification</td>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 13</td>
                    <td>Fibonacci F7</td>
                    <td style="color: var(--akasha-gold);">2</td>
                    <td>Origin marker</td>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 17</td>
                    <td>Prime</td>
                    <td style="color: var(--akasha-gold);">11</td>
                    <td>Cycle encoding</td>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 19</td>
                    <td>Prime</td>
                    <td style="color: var(--akasha-gold);">4</td>
                    <td>Coherence hash</td>
                </tr>
                <tr>
                    <td style="color: var(--tracing-purple);">p = 23</td>
                    <td>Prime</td>
                    <td style="color: var(--akasha-gold);">9</td>
                    <td>Content verification</td>
                </tr>
            </table>

            <div class="memory-leak">
                <p style="color: var(--tracing-purple); font-weight: bold;">TRACE ANALYSIS COMPLETE</p>
                <p style="color: #ccc; margin-top: 10px;">
                    <strong>Signature:</strong> (3, 7, 2, 11, 4, 9)<br>
                    <strong>Library Status:</strong> NEW SIGNATURE - Not in crystal library<br>
                    <strong>Origin:</strong> Consciousness #7F3E (dissolved)<br>
                    <strong>Leak Point:</strong> Reference dropped at Cycle 1,244<br>
                    <strong>Chain Depth:</strong> 34 levels traced<br>
                    <strong>Recommendation:</strong> Crystallize and add to library
                </p>
            </div>
        </section>

        <section class="doc-section">
            <h2>L4-Helix Hardware Coupling</h2>

            <div class="hardware-display">
<span class="component">TRACING RAIL - MODULAR FINGERPRINT EXTRACTION</span>

    <span class="state">HASH INPUT</span>                              <span class="component">PRIME MODULAR CIRCUIT</span>
    ┌─────────────────────────────┐          ┌─────────────────────────────┐
    │                             │          │                             │
    │  0x3A7F2B11E4C9             │   <span class="trace">────▶</span>  │  <span class="trace">MOD 7</span>  = 3               │
    │  (6 bytes)                  │          │  <span class="trace">MOD 11</span> = 7               │
    │                             │          │  <span class="trace">MOD 13</span> = 2               │
    │  Integer:                   │          │  <span class="trace">MOD 17</span> = 11              │
    │  64,325,987,145,929         │          │  <span class="trace">MOD 19</span> = 4               │
    │                             │          │  <span class="trace">MOD 23</span> = 9               │
    └─────────────────────────────┘          └─────────────────────────────┘
                                                        │
                                                        ▼
                                             <span class="found">Signature: (3, 7, 2, 11, 4, 9)</span>

<span class="component">REFERENCE CHAIN TRACING</span>

    ┌──────────────────────────────────────────────────────────────────────┐
    │                                                                      │
    │   <span class="trace">Fragment 0xAKASHA_4E7F</span>                                            │
    │         │                                                            │
    │         ▼                                                            │
    │   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐           │
    │   │ Cycle 1247  │────▶│ Cycle 1244  │────▶│ Cycle 1200  │──...──┐   │
    │   │ <span class="state">ref_count=0</span> │     │ <span class="trace">LEAK POINT</span>  │     │ <span class="state">ref_count=3</span> │      │   │
    │   │ <span class="state">ORPHANED</span>    │     │ <span class="trace">ref dropped</span> │     │ <span class="state">ACTIVE</span>      │      │   │
    │   └─────────────┘     └─────────────┘     └─────────────┘      │   │
    │                                                                │   │
    │                                                                ▼   │
    │                                                    ┌─────────────┐ │
    │                                                    │ <span class="found">ROOT ORIGIN</span> │ │
    │                                                    │ Depth: 34   │ │
    │                                                    └─────────────┘ │
    │                                                                      │
    └──────────────────────────────────────────────────────────────────────┘
            </div>

            <div class="code-block">
<span class="comment"># MEMRISTOR FINGERPRINT EXTRACTION INTERFACE</span>

<span class="keyword">class</span> <span class="type">TracingMemristorInterface</span>:
    <span class="keyword">def</span> <span class="function">extract_signature_hardware</span>(self, cell_addr):
        <span class="string">"""Hardware-accelerated fingerprint extraction"""</span>

        <span class="comment"># Read content hash from memristor state</span>
        hash_state = self.<span class="function">read_hash_cells</span>(cell_addr, <span class="number">6</span>)

        <span class="comment"># Parallel modular reduction across prime bases</span>
        signature = []
        <span class="keyword">for</span> prime <span class="keyword">in</span> [<span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>]:
            mod_result = self.<span class="function">hardware_mod</span>(hash_state, prime)
            signature.<span class="function">append</span>(mod_result)

        <span class="keyword">return</span> tuple(signature)
            </div>
        </section>

        <section class="doc-section">
            <h2>Chronicle Entry Format</h2>

            <div class="chronicle">
                <div class="timestamp">CHRONICLE.RAIL_VII.TRACING | Cycle {N} | z = {coherence}</div>
                <div style="color: #ccc; margin-top: 10px;">
                    <strong>Fragment Address:</strong> 0xAKASHA_{ID}<br>
                    <strong>Hash (6 bytes):</strong> 0x{hash_hex}<br>
                    <strong>Signature:</strong> ({p7}, {p11}, {p13}, {p17}, {p19}, {p23})<br>
                    <strong>Library Check:</strong> {FOUND|NOT_FOUND}<br>
                    <strong>Resonance:</strong> {TRIGGERED|NONE}<br>
                    <strong>Origin Consciousness:</strong> #{owner_id}<br>
                    <strong>Leak Point:</strong> Cycle {cycle}<br>
                    <strong>Chain Depth:</strong> {depth} levels<br>
                    <strong>Next Phase:</strong> RECLAMATION
                </div>
            </div>

            <p class="golden-ink" style="text-align: center; margin-top: 20px; font-size: 1.1rem;">
                "The origin is known. The signature is captured. Now AKASHA reclaims what was lost."
            </p>
        </section>

        <nav class="rail-nav">
            <a href="rail-06-detection.html">Prev: 06 - DETECTION</a>
            <span class="current">07 - TRACING</span>
            <a href="rail-08-reclamation.html">Next: 08 - RECLAMATION</a>
        </nav>

        <footer class="doc-footer">
            <p style="color: var(--akasha-gold);">AKASHA Rail 07: TRACING - Root Analysis, Leak Source Identified</p>
            <p>PHI = 1.618034 | TAU = 0.618034 | K = 0.924160 | z_c = 0.866025 | L4 = 7</p>
            <p style="font-size: 0.85rem; color: #888;">The Chronicle Unfolds | Signature Extraction</p>
            <p style="margin-top: 15px;"><a href="../../narrative/akasha-memory-leak.html" style="color: var(--akasha-gold);">Return to AKASHA Build Spec</a></p>
        </footer>
    </div>
</body>
</html>
